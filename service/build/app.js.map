{"version":3,"file":"app.js","names":["express","require","app","quertstring","expressjwt","jwt","auth","Auth","jwks","jwtCheck","secret","expressJwtSecret","cache","rateLimit","jwksRequestsPerMinute","jwksUri","audience","issuer","algorithms","unless","path","use","post","req","res","result","authAccount","headers","authorization","console","log","stringify","send","get","ss","scope","split","includes","listen"],"sources":["../src/app.js"],"sourcesContent":["import {Auth} from './auth.js';\r\n\r\nconst express = require(\"express\");\r\nconst app = express();\r\n\r\nvar quertstring = require(\"querystring\");\r\n\r\nvar { expressjwt: jwt } = require(\"express-jwt\");\r\n\r\nconst auth=new Auth();\r\n\r\nvar jwks = require(\"jwks-rsa\");\r\n\r\nvar jwtCheck = jwt({\r\n  secret: jwks.expressJwtSecret({\r\n    cache: true,\r\n    rateLimit: true,\r\n    jwksRequestsPerMinute: 5,\r\n    jwksUri:\r\n      \"https://qd-awesome-app-demo.authing.cn/oidc/.well-known/jwks.json\",\r\n  }),\r\n  audience: \"637f3469b33a8ef36d2b03c5\",\r\n  issuer: \"https://qd-awesome-app-demo.authing.cn/oidc\",\r\n  algorithms: [\"RS256\"],\r\n}).unless({ path: [/^\\/api\\//] });\r\n\r\n\r\napp.use(jwtCheck);\r\n\r\napp.post(\"/api/login\", (req, res) => {\r\n\r\n   var result= auth.authAccount(req.headers.authorization);\r\n  console.log(quertstring.stringify(result));\r\n  res.send(result);\r\n});\r\n\r\napp.get(\"/article\", (req, res) => {\r\n  var ss = quertstring.stringify(req);\r\n  console.log(ss);\r\n\r\n  if (req.auth.scope.split(\" \").includes(\"disk:call\")) {\r\n    res.send(\"disk info\");\r\n  } else {\r\n    res.send(\"not authorized api\");\r\n  }\r\n});\r\n\r\napp.listen(3000, () => {\r\n  console.log(\"app listening on port 3000\");\r\n});\r\n"],"mappings":";;AAAA;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,GAAG,GAAGF,OAAO,EAAE;AAErB,IAAIG,WAAW,GAAGF,OAAO,CAAC,aAAa,CAAC;AAExC,IAAI;EAAEG,UAAU,EAAEC;AAAI,CAAC,GAAGJ,OAAO,CAAC,aAAa,CAAC;AAEhD,MAAMK,IAAI,GAAC,IAAIC,UAAI,EAAE;AAErB,IAAIC,IAAI,GAAGP,OAAO,CAAC,UAAU,CAAC;AAE9B,IAAIQ,QAAQ,GAAGJ,GAAG,CAAC;EACjBK,MAAM,EAAEF,IAAI,CAACG,gBAAgB,CAAC;IAC5BC,KAAK,EAAE,IAAI;IACXC,SAAS,EAAE,IAAI;IACfC,qBAAqB,EAAE,CAAC;IACxBC,OAAO,EACL;EACJ,CAAC,CAAC;EACFC,QAAQ,EAAE,0BAA0B;EACpCC,MAAM,EAAE,6CAA6C;EACrDC,UAAU,EAAE,CAAC,OAAO;AACtB,CAAC,CAAC,CAACC,MAAM,CAAC;EAAEC,IAAI,EAAE,CAAC,UAAU;AAAE,CAAC,CAAC;AAGjClB,GAAG,CAACmB,GAAG,CAACZ,QAAQ,CAAC;AAEjBP,GAAG,CAACoB,IAAI,CAAC,YAAY,EAAE,CAACC,GAAG,EAAEC,GAAG,KAAK;EAElC,IAAIC,MAAM,GAAEnB,IAAI,CAACoB,WAAW,CAACH,GAAG,CAACI,OAAO,CAACC,aAAa,CAAC;EACxDC,OAAO,CAACC,GAAG,CAAC3B,WAAW,CAAC4B,SAAS,CAACN,MAAM,CAAC,CAAC;EAC1CD,GAAG,CAACQ,IAAI,CAACP,MAAM,CAAC;AAClB,CAAC,CAAC;AAEFvB,GAAG,CAAC+B,GAAG,CAAC,UAAU,EAAE,CAACV,GAAG,EAAEC,GAAG,KAAK;EAChC,IAAIU,EAAE,GAAG/B,WAAW,CAAC4B,SAAS,CAACR,GAAG,CAAC;EACnCM,OAAO,CAACC,GAAG,CAACI,EAAE,CAAC;EAEf,IAAIX,GAAG,CAACjB,IAAI,CAAC6B,KAAK,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,QAAQ,CAAC,WAAW,CAAC,EAAE;IACnDb,GAAG,CAACQ,IAAI,CAAC,WAAW,CAAC;EACvB,CAAC,MAAM;IACLR,GAAG,CAACQ,IAAI,CAAC,oBAAoB,CAAC;EAChC;AACF,CAAC,CAAC;AAEF9B,GAAG,CAACoC,MAAM,CAAC,IAAI,EAAE,MAAM;EACrBT,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;AAC3C,CAAC,CAAC"}